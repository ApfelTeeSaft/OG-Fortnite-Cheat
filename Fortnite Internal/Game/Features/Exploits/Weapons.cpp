#include "Weapons.h"

#include "../../SDK/Classes/FortniteGame_Classes.h"

#include "../../../Configs/Config.h"

#include "../../SDK/SDKInitializer.h"

void Features::Exploits::Weapons::Tick(SDK::AFortWeapon* Weapon) {
	if (Weapon) {
		// We have to init here because we need a valid AFortWeapon to get the VFT
		if (SDK::Cached::VFT::GetWeaponStats == 0x0) {
			SDKInitializer::InitGetWeaponStatsIndex(Weapon);
		}
		else {
			SDK::FFortBaseWeaponStats* WeaponStats = nullptr;
			WeaponStats = Weapon->WeaponStats();

			if (WeaponStats) {
				if (Config::Exploits::Pickaxe::Enabled && Weapon->IsPickaxe()) {
					SDK::FFortMeleeWeaponStats* MeleeWeaponStats = (SDK::FFortMeleeWeaponStats*)WeaponStats;
					MeleeWeaponStats->SetSwingPlaySpeed(Config::Exploits::Pickaxe::SpeedMultiplier);
				}
				else if (Config::Exploits::Weapon::Enabled && Weapon->IsA(SDK::AFortWeaponRanged::StaticClass())) {
					SDK::FFortRangedWeaponStats* RangedWeaponStats = (SDK::FFortRangedWeaponStats*)WeaponStats;

					if (Config::Exploits::Weapon::NoSpread) {
						// you definetly dont need to do all of these, but yeah
						RangedWeaponStats->SetSpread(0.f);
						RangedWeaponStats->SetSpreadDownsights(0.f);
						RangedWeaponStats->SetStandingStillSpreadMultiplier(0.f);
						RangedWeaponStats->SetAthenaCrouchingSpreadMultiplier(0.f);
						RangedWeaponStats->SetAthenaJumpingFallingSpreadMultiplier(0.f);
						RangedWeaponStats->SetAthenaSprintingSpreadMultiplier(0.f);
						RangedWeaponStats->SetMinSpeedForSpreadMultiplier(FLT_MAX);
						RangedWeaponStats->SetMaxSpeedForSpreadMultiplier(FLT_MAX);
					}

					if (Config::Exploits::Weapon::NoReload) {
						RangedWeaponStats->SetReloadTime(0.f);
						RangedWeaponStats->SetReloadTime(0.f);
					}

					if (Config::Exploits::Weapon::NoRecoil) {
						RangedWeaponStats->SetRecoilVert(0.f);
						RangedWeaponStats->SetRecoilHoriz(0.f);
					}

					if (Config::Exploits::Weapon::DamageMultiplier != 1) {
						RangedWeaponStats->SetBulletsPerCartridge(Config::Exploits::Weapon::DamageMultiplier);
					}
				}
			}
		}
	}
}